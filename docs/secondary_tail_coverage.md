# Статус доработок по второстепенным проверкам

Документ фиксирует текущее покрытие для дополнений, которые упоминались как второстепенные
хвосты. Для каждой темы перечислены реализованные проверки и связанные автоматические тесты.

## Хронометрия (chrony/systemd-timesyncd)
- В базовом профиле реализованы проверки активности службы и наличия надёжных источников
  (`base_ntp_service_active`, `base_ntp_sources_reliable`). Ожидание для `sources` требует
  как минимум одного первичного источника и двух общих источников либо переводит правило в
  `skipped`.【F:profiles/base-linux.yml†L331-L375】
- Проверка `base_ntp_makestep` подтверждает наличие директивы `makestep`, а `base_ntp_minsources`
  заставляет настраивать не менее двух источников при активном `chronyd`.【F:profiles/base-linux.yml†L383-L409】
- Модульные тесты фиксируют регулярные выражения для `sources`, `makestep` и `minsources`,
  чтобы не размыть строгость при будущих правках профиля.【F:tests/test_profiles.py†L29-L60】

## Опции монтирования временных каталогов
- Для `/tmp`, `/var/tmp` и `/home` в базовом профиле зашиты требования `nodev`, `nosuid`,
  `noexec` (где применимо).【F:profiles/base-linux.yml†L675-L704】
- Юнит-тесты проверяют, что соответствующие регулярные выражения действительно требуют все
  флаги и не допускают пустых значений.【F:tests/test_profiles.py†L74-L88】

## Fail2ban и вспомогательные службы
- Проверки `base_fail2ban_active` и `base_fail2ban_jails` убеждаются, что служба активна и
  хотя бы одна jail включена при наличии `fail2ban`.【F:profiles/base-linux.yml†L1061-L1089】
- Правило `base_services_redundant_disabled` отслеживает отключение CUPS, Avahi, bluetooth и
  SSH-agent, если они присутствуют в системе.【F:profiles/base-linux.yml†L1091-L1104】

## Подписи репозиториев и минимальные версии пакетов
- Для APT проверяется наличие параметра `Signed-By` у всех активных источников и отсутствие
  `trusted=yes`, что предотвращает обход проверки подписи. Для RPM гарантируется `gpgcheck`.
  【F:profiles/base-linux.yml†L845-L888】
- Минимальные версии заданы для ядра (≥4.18), `sudo` (≥1.9.5) и `openssh-server` (≥8.0).
  Правила работают и для RPM, и для DEB дистрибутивов.【F:profiles/base-linux.yml†L900-L964】

## Автоматическое тестирование
- Файл `tests/test_profiles.py` содержит точечные проверки для ключевых регулярных выражений.
  При добавлении новых проверок следует расширять этот набор.
- Workflow `workflows/ci.yml` гоняет `pytest`, `flake8`, `mypy` и `yamllint` на всех ветках,
  обеспечивая запуск тестов для каждого профиля на CI.【F:workflows/ci.yml†L1-L58】
