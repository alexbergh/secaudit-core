# План работы

## Цели
- Расширить автоматизированное покрытие для переработанного движка аудита и улучшенного CLI.
- Обновить документацию, чтобы описать новые флаги CLI и изменения структуры профилей.
- Провести валидацию и корректировку профилей после новой реорганизации директорий.

## Шаги
1. **Изучение изменений движка**
   - Перечитать `modules/audit_runner.py`, чтобы подтвердить ожидания по работе `extends`, разрешению переменных, обработке allowlist, кешированию фактов и новым статус-значениям.
   - Определить критические участки кода без тестов (параллельное выполнение, переопределения переменных, сравнение allowlist, итоговое оценивание, фрагменты доказательств).

2. **Добавление целевых тестов**
   - Расширить `tests/test_audit_runner.py` кейсами для проверки:
     - Подстановки переменных с уровня CLI/окружения.
     - Наследования профилей через `extends`, включая глубокую вложенность и приоритет переопределений.
     - Сравнения allowlist для правил SUID/портов.
     - Кеширования фактов с проверкой, что shell-команды вызываются однократно.
     - Поведения параллельного исполнителя (ограничение числа воркеров, обработка таймаута/UNDEF-пути где применимо).
   - Добавить CLI-тесты для разбора `--level`, `--var` и `--workers`, чтобы убедиться, что они корректно передаются в движок.

3. **Валидация профилей и документации**
   - Запустить `secaudit validate` (или эквивалент) на реорганизованных профилях; исправить YAML при наличии нарушений схемы.
   - Обновить `README.md` и каталог `docs/`, чтобы отразить новую структуру профилей, уровни строгости и опции CLI.
   - Убедиться, что `profiles/include/vars_*.env` содержат требуемые пороговые значения и при необходимости упомянуты в `profiles/README.md`.

4. **Отчётность и вывод**
   - Подкорректировать шаблоны отчётов или добавить TODO в документацию, если модификации выходят за рамки текущей итерации.
   - Проверить, что структура JSON-сводки соответствует требованиям последующих систем; задокументировать изменения в README/CHANGELOG при необходимости.

5. **Проверка**
   - Выполнить `pytest` и репрезентативные команды `secaudit audit`, чтобы подтвердить поведение и зафиксировать пример выходных данных.
   - Подготовить описание PR с упоминанием новых тестов и обновлений документации.
